name: Decision Deposit Placer

on:
  # Run on a schedule (every 4 hours)
  schedule:
    - cron: '0 */4 * * *'
  
  # Allow manual triggering without customizable inputs
  workflow_dispatch:

jobs:
  run-depositor:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm install
      
      - name: Create .env file
        run: |
          cat > .env << EOF
          # Networks to process
          NETWORKS=polkadot,kusama

          # Account seed (from secrets)
          ACCOUNT_SEED=${{ secrets.ACCOUNT_SEED }}
          SS58_ADDRESS=${{ secrets.SS58_ADDRESS }}

          # Track IDs to monitor
          TRACK_IDS=${{ secrets.TRACK_IDS || '30' }}

          # Whether to place deposits
          PLACE_DEPOSITS=${{ secrets.PLACE_DEPOSITS || 'false' }}

          # RPC Endpoints
          POLKADOT_RPC_ENDPOINT=${{ secrets.POLKADOT_RPC_ENDPOINT || 'wss://rpc.polkadot.io' }}
          KUSAMA_RPC_ENDPOINT=${{ secrets.KUSAMA_RPC_ENDPOINT || 'wss://kusama-rpc.polkadot.io' }}
          EOF
      
      - name: Run decision depositor
        run: node decision-depositor.js